<ng-container *ngIf="loading">
  <p class="status">Cargando…</p>
</ng-container>

<div class="status error" *ngIf="error">
  {{ error }}
</div>

<header class="site-header py-2">
  <!-- Logo + Navigation -->
  <!-- Logo + Navigation -->
  <div class="container-fluid header-container d-flex flex-column flex-md-row align-items-center justify-content-between gap-3 px-3">
    <a class="logo me-auto me-lg-5" routerLink="/home">Healthy Eats</a>
    <nav class="mt-2 mt-md-0" aria-label="Main navigation">
      <ul class="nav-links d-flex flex-wrap justify-content-center justify-content-md-end align-items-center gap-3">
        <li>
          <a [routerLink]="['/home']" title="Inicio">
            <i class="bi bi-house-door fs-3"></i>
          </a>
        </li>
        <li>
          <a [routerLink]="['/menu']" title="Menú">
            <i class="bi bi-card-list fs-3"></i>
          </a>
        </li>
        <li>
          <a [routerLink]="['/planes']" title="Planes">
            <i class="bi bi-calendar-check fs-3"></i>
          </a>
        </li>
        <li>
          <a [routerLink]="['/premium/plans']" title="Premium">
            <i class="bi bi-star-fill fs-3"></i>
          </a>
        </li>
        <li>
          <a [routerLink]="['/contacto']" title="Contacto">
            <i class="bi bi-envelope fs-3"></i>
          </a>
        </li>
        <li>
          <a [routerLink]="['/carrito']" title="Carrito">
            <i class="bi bi-cart"></i>
          </a>
        </li>

        <!-- Popup-dropdown de usuario -->
        <li>
          <label class="popup">
            <input type="checkbox" />
            <div tabindex="0" class="burger">
              <svg
                viewBox="0 0 24 24"
                fill="white"
                height="20"
                width="20"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M12 2c2.757 0 5 2.243 5 5.001 0 2.756-2.243 5-5 5s-5-2.244-5-5c0-2.758 2.243-5.001 5-5.001zm0-2c-3.866 0-7 3.134-7 7.001 0 3.865 3.134 7 7 7s7-3.135 7-7c0-3.867-3.134-7.001-7-7.001zm6.369 13.353c-.497.498-1.057.931-1.658 1.302 2.872 1.874 4.378 5.083 4.972 7.346h-19.387c.572-2.29 2.058-5.503 4.973-7.358-.603-.374-1.162-.811-1.658-1.312-4.258 3.072-5.611 8.506-5.611 10.669h24c0-2.142-1.44-7.557-5.631-10.647z"
                ></path>
              </svg>
            </div>
            <nav class="popup-window">
              <legend>Usuario</legend>
              <ul>
                <li>
                  <button (click)="router.navigate(['/profile'])">
                    <i class="bi bi-person-circle"></i>
                    <span>Perfil</span>
                  </button>
                </li>
                <li>
                  <button (click)="router.navigate(['/settings'])">
                    <i class="bi bi-gear"></i>
                    <span>Configuración</span>
                  </button>
                </li>
                <hr />
                <li>
                  <button (click)="authSrvc.logout()">
                    <i class="bi bi-box-arrow-right"></i>
                    <span>Logout</span>
                  </button>
                </li>
              </ul>
            </nav>
          </label>
        </li>
      </ul>
    </nav>
  </div>
</header>

<main class="container my-5">
  <h1 class="plan-title text-center">Planes Personalizados</h1>
  <p class="plan-subtitle text-center mb-4">
    Elige entre generar tu plan manualmente o recibir recomendaciones con ayuda de nuestra IA nutricional.
  </p>

  <div class="mode-switch d-flex justify-content-center gap-3 mb-4" role="group" aria-label="Seleccionar modo">
    <button
      type="button"
      [class.active]="mode === 'DIY'"
    >
      Hazlo tú
    </button>
  </div>

  <form [formGroup]="form" (ngSubmit)="submit()" class="plan-form row g-3">
    <div class="form-group">
      <label for="caloriesPerDay" class="form-label">Kcal por día</label>
      <input
        id="caloriesPerDay"
        type="number"
        min="1000"
        max="5000"
        class="form-control"
        formControlName="caloriesPerDay"
        required
      />
    </div>
    <div class="form-group">
      <label for="mealsPerDay" class="form-label">Comidas al día</label>
      <input
        id="mealsPerDay"
        type="number"
        min="1"
        class="form-control"
        max="6"
        formControlName="mealsPerDay"
        required
      />
    </div>
    <div class="form-group">
      <label for="dietaryPreferences" class="form-label">Preferencias dietéticas</label>
      <input
        id="dietaryPreferences"
        type="text"
        class="form-control"
        formControlName="dietaryPreferences"
        placeholder="Ej. vegan, chicken, starter"
      />
    </div>

    <button
      type="submit"
      class="submit-btn"
      [disabled]="form.invalid || loading"
    >
      {{ mode === 'DIY' ? 'Generar mi plan' : 'Pedir a la IA' }}
    </button>
  </form>

  <section *ngIf="generatedPlan" class="plan-output mt-5" aria-live="polite">
    <h2 class="text-center mb-4">Tu Plan Semanal</h2>
    <ul class="list-unstyled row g-4">
      <li *ngFor="let dia of planSemanal" class="col-md-4 text-center">
        <strong>{{ dia.dia }}</strong>: {{ dia.receta.strMeal }}
        <img [src]="dia.receta.strMealThumb" alt="{{ dia.receta.strMeal }}" width="120" class="img-fluid rounded mt-2"/>
      </li>
    </ul>
    <pre class="bg-light p-3 rounded mt-4">{{ generatedPlan }}</pre>
  </section>
</main>

<footer class="footer bg-dark text-white py-3 mt-5 text-center">
  <div class="footer-content">
    <p class="mb-0">&copy; Healthy Eats. Todos los derechos reservados.</p>
  </div>
</footer>
