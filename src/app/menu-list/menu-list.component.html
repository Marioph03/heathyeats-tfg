<ng-container *ngIf="loading">
  <p class="status text-center py-3">Cargando…</p>
</ng-container>
<div class="status error text-center text-danger py-2" *ngIf="error">{{ error }}</div>

<header class="site-header py-2">
  <!-- Theme toggle -->
  <div class="toggle-switch me-3">
    <label class="switch-label">
      <input
        type="checkbox"
        class="checkbox"
        [checked]="isDarkTheme"
        (change)="toggleTheme()"
      />
      <span class="slider"></span>
    </label>
  </div>

  <!-- Logo + Navigation -->
  <div class="container-fluid header-container d-flex flex-column flex-md-row align-items-center justify-content-between gap-3 px-3">
    <a class="logo me-auto me-lg-5" routerLink="/home">Healthy Eats</a>
    <nav class="mt-2 mt-md-0" aria-label="Main navigation">
      <ul class="nav-links d-flex flex-wrap justify-content-center justify-content-md-end align-items-center gap-3">
        <li>
          <a [routerLink]="['/home']" title="Inicio">
            <i class="bi bi-house-door fs-3"></i>
          </a>
        </li>
        <li>
          <a [routerLink]="['/menu']" title="Menú">
            <i class="bi bi-card-list fs-3"></i>
          </a>
        </li>
        <li>
          <a [routerLink]="['/planes']" title="Planes">
            <i class="bi bi-calendar-check fs-3"></i>
          </a>
        </li>
        <li>
          <a [routerLink]="['/premium/plans']" title="Premium">
            <i class="bi bi-star-fill fs-3"></i>
          </a>
        </li>
        <li>
          <a [routerLink]="['/contacto']" title="Contacto">
            <i class="bi bi-envelope fs-3"></i>
          </a>
        </li>
        <li>
          <a [routerLink]="['/carrito']" title="Carrito">
            <i class="bi bi-cart"></i>
          </a>
        </li>

        <!-- Popup-dropdown de usuario -->
        <li>
          <label class="popup">
            <input type="checkbox" />
            <div tabindex="0" class="burger">
              <svg
                viewBox="0 0 24 24"
                fill="white"
                height="20"
                width="20"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M12 2c2.757 0 5 2.243 5 5.001 0 2.756-2.243 5-5 5s-5-2.244-5-5c0-2.758 2.243-5.001 5-5.001zm0-2c-3.866 0-7 3.134-7 7.001 0 3.865 3.134 7 7 7s7-3.135 7-7c0-3.867-3.134-7.001-7-7.001zm6.369 13.353c-.497.498-1.057.931-1.658 1.302 2.872 1.874 4.378 5.083 4.972 7.346h-19.387c.572-2.29 2.058-5.503 4.973-7.358-.603-.374-1.162-.811-1.658-1.312-4.258 3.072-5.611 8.506-5.611 10.669h24c0-2.142-1.44-7.557-5.631-10.647z"
                ></path>
              </svg>
            </div>
            <nav class="popup-window">
              <legend>Usuario</legend>
              <ul>
                <li>
                  <button (click)="router.navigate(['/profile'])">
                    <i class="bi bi-person-circle"></i>
                    <span>Perfil</span>
                  </button>
                </li>
                <li>
                  <button (click)="router.navigate(['/settings'])">
                    <i class="bi bi-gear"></i>
                    <span>Configuración</span>
                  </button>
                </li>
                <hr />
                <li>
                  <button (click)="authSrvc.logout()">
                    <i class="bi bi-box-arrow-right"></i>
                    <span>Logout</span>
                  </button>
                </li>
              </ul>
            </nav>
          </label>
        </li>
      </ul>
    </nav>
  </div>
</header>

<main class="container-fluid py-4">
  <section *ngFor="let sec of sections" class="menu-section mb-5">
    <h2 class="menu-section__title text-center mb-4"> {{ sec.title }} </h2>
    <div class="menu-list row row-cols-1 row-cols-sm-2 row-cols-md-3 g-4">
      <div
        class="card"
        *ngFor="let meal of sec.meals"
        (click)="selectMeal(meal)"
      >
        <div class="content">
          <img [src]="meal.strMealThumb" [alt]="meal.strMeal" />
          <div class="description">
            <p class="title"><strong> {{ meal.strMeal }} </strong></p>
            <p class="info"> {{meal.strCategory}} </p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div class="detail-modal" *ngIf="selectedMealDetail">
    <div class="modal-backdrop" (click)="closeDetail()"></div>
    <div class="modal position-fixed top-50 start-50 translate-middle bg-white p-4 rounded shadow" style="z-index: 1050; max-width: 90%; width: 600px;">
      <button class="close-btn position-absolute top-0 end-0 m-2" (click)="closeDetail()">×</button>

      <img
        class="modal-img rounded mb-3"
        [src]="selectedMealDetail.strMealThumb"
        [alt]="selectedMealDetail.strMeal"
      />

      <p class="modal-price fs-5">
        <strong>Precio:</strong>
        {{ price | currency:'EUR':'symbol':'1.2-2' }}
      </p>

      <div class="stock-control d-flex align-items-center gap-3 mb-3">
        <button (click)="decreaseStock()">−</button>
        <span>{{ stockCount }}</span>
        <button (click)="increaseStock()">+</button>
      </div>

      <button class="add-cart-btn btn-success w-100 mb-3" (click)="addToCart()">
        Añadir al carrito
      </button>

      <!-- Datos de la receta en español -->
      <h3>{{ selectedMealDetail.strMeal }}</h3>
      <p><em>Categoría:</em> {{ selectedMealDetail.strCategory }}</p>
      <p><em>Origen:</em> {{ selectedMealDetail.strArea }}</p>

      <h4>Ingredientes:</h4>
      <ul>
        <li *ngFor="let ing of getIngredients(selectedMealDetail)">
          {{ ing }}
        </li>
      </ul>

      <h4>Instrucciones:</h4>
      <p>{{ selectedMealDetail.strInstructions }}</p>
    </div>
  </div>
</main>
